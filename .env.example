# ==============================================================================
# Werewolf AI - Environment Configuration Template
# Werewolf AI - 环境配置模板
# ==============================================================================
#
# Quick Start / 快速开始：
#   1. cp .env.example .env
#   2. Set JWT_SECRET_KEY (required) / 设置 JWT_SECRET_KEY（必填）
#   3. Set OPENAI_API_KEY or LLM_USE_MOCK=true / 设置 OPENAI_API_KEY 或 LLM_USE_MOCK=true
#   4. docker compose up -d
#
# ==============================================================================


# ------------------------------------------------------------------------------
# 1. Core Configuration / 核心配置
# ------------------------------------------------------------------------------

# JWT Secret Key [required] / JWT 密钥 [必填]
# Used for player authentication and WebSocket connections
# 用于玩家身份验证和 WebSocket 连接
# Generate / 生成命令: openssl rand -hex 32
JWT_SECRET_KEY=

# OpenAI API Key [recommended] / OpenAI API 密钥 [推荐]
# Get yours at / 获取地址: https://platform.openai.com/api-keys
# If not set, use LLM_USE_MOCK=true for testing
# 如未设置，可使用 LLM_USE_MOCK=true 进行测试
OPENAI_API_KEY=

# OpenAI API Base URL [optional] / OpenAI API 基础 URL [可选]
# For custom API endpoints (e.g., proxy services)
# 用于自定义 API 端点（如代理服务）
# OPENAI_BASE_URL=https://api.openai.com/v1


# ------------------------------------------------------------------------------
# 2. LLM Model Configuration / LLM 模型配置
# ------------------------------------------------------------------------------

# Default LLM model / 默认 LLM 模型
LLM_MODEL=gpt-4o-mini

# Maximum API call retries / API 调用最大重试次数
LLM_MAX_RETRIES=2

# Mock mode (no real API calls, for testing)
# 模拟模式（不调用真实 API，用于测试）
# Set to true if no API key is configured
# 如未配置 API 密钥，请设为 true
LLM_USE_MOCK=false


# ------------------------------------------------------------------------------
# 3. Application Configuration / 应用配置
# ------------------------------------------------------------------------------

# Debug mode / 调试模式
DEBUG=false

# Log level / 日志级别: DEBUG | INFO | WARNING | ERROR
LOG_LEVEL=INFO

# Data storage directory (for SQLite database, etc.)
# 数据存储目录（用于 SQLite 数据库等）
DATA_DIR=data


# ------------------------------------------------------------------------------
# 4. Admin Features Configuration / 管理功能配置
# ------------------------------------------------------------------------------

# Environment variable management toggle
# 环境变量管理开关
# When enabled, allows editing .env via admin panel
# 启用后，允许通过管理面板编辑 .env 文件
# Recommended: disable in production / 建议：生产环境禁用
# Note: This only affects env editing, not admin panel login
# 注意：此选项仅影响环境变量编辑，不影响管理面板登录
ENV_MANAGEMENT_ENABLED=false

# --- Admin Update Feature / 管理面板更新功能 ---
# Enables manual update from admin panel (git pull + docker compose up)
# 启用管理面板的手动更新功能（git pull + docker compose up）
# Requires Update Agent service running on host machine
# 需要在宿主机运行 Update Agent 服务
UPDATE_AGENT_ENABLED=false

# Update Agent URL (host-side service)
# 更新代理 URL（宿主机侧服务）
#
# IMPORTANT for Docker deployment:
# - Use http://host.docker.internal:9999 (NOT 127.0.0.1)
# - 127.0.0.1 inside container refers to container itself, not host
#
# Docker 部署重要说明：
# - 必须使用 http://host.docker.internal:9999（不能用 127.0.0.1）
# - 容器内的 127.0.0.1 指向容器自身，无法访问宿主机
#
# Example / 示例:
#   Local dev / 本地开发: http://127.0.0.1:9999
#   Docker / 容器部署:    http://host.docker.internal:9999
UPDATE_AGENT_URL=

# Shared secret for backend -> update agent authentication
# 后端 -> 更新代理的共享密钥
# Generate / 生成命令: openssl rand -hex 32
UPDATE_AGENT_TOKEN=

# HTTP timeout for update agent calls (seconds)
# 更新代理调用的 HTTP 超时时间（秒）
UPDATE_AGENT_TIMEOUT_SECONDS=3

# Block update when active games/users detected
# 检测到活跃游戏/用户时阻止更新
UPDATE_BLOCK_IF_PLAYING_ROOMS=true
UPDATE_BLOCK_IF_ACTIVE_GAME_WS=true

# Force update confirmation phrase (required to bypass blocking)
# 强制更新确认短语（绕过阻断时必须提供）
UPDATE_FORCE_CONFIRM_PHRASE=UPDATE


# ------------------------------------------------------------------------------
# 5. Security Configuration / 安全配置
# ------------------------------------------------------------------------------

# Frontend URL [docker deploy required] / 前端 URL [Docker 部署必填]
# Used for WebSocket origin validation and CORS
# 用于 WebSocket 来源验证和 CORS
# Example / 示例: https://your-domain.com
FRONTEND_URL=

# Allowed WebSocket Origins [optional] / 允许的 WebSocket 来源 [可选]
# If not set, derived from FRONTEND_URL
# 如未设置，从 FRONTEND_URL 自动派生
# Format / 格式: comma-separated origins / 逗号分隔的来源
# Example / 示例: https://your-domain.com,https://www.your-domain.com
# ALLOWED_WS_ORIGINS=

# Admin Password [recommended] / 管理员密码 [推荐]
# Simple password authentication for admin panel
# 管理面板的简单密码认证
ADMIN_PASSWORD=

# Debug mode (controls debug-messages API endpoint)
# 调试模式（控制 debug-messages API 端点）
DEBUG_MODE=false

# Trusted proxies (for correct client IP detection)
# 可信代理（用于正确检测客户端 IP）
# Format / 格式: comma-separated IPs or CIDRs / 逗号分隔的 IP 或 CIDR
# Example / 示例: 127.0.0.1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
# Empty = trust no proxy (use direct connection IP)
# 留空 = 不信任任何代理（使用直连 IP）
# TRUSTED_PROXIES=127.0.0.1

# CORS Configuration [docker deploy required]
# CORS 配置 [Docker 部署必填]
# Format / 格式: comma-separated allowed origins / 逗号分隔的允许来源
#
# WARNING: Using "*" disables Cookie authentication,
#          causing room creation and other features to fail!
# 警告：使用 "*" 会禁用 Cookie 认证，导致创建房间等功能失效！
#
# Docker deployment - set to your actual domain:
# Docker 部署 - 设置为你的实际域名：
CORS_ORIGINS=https://your-domain.com
#
# Local development example / 本地开发示例:
# CORS_ORIGINS=http://localhost:5173,http://localhost:3000
#
# Multiple domains example / 多域名示例:
# CORS_ORIGINS=https://your-domain.com,https://www.your-domain.com


# ------------------------------------------------------------------------------
# 6. JWT Authentication Configuration / JWT 认证配置
# ------------------------------------------------------------------------------

# JWT signing algorithm / JWT 签名算法
JWT_ALGORITHM=HS256

# JWT expiration time (minutes) / JWT 过期时间（分钟）
# Default / 默认: 7 days / 7 天 = 60 * 24 * 7 = 10080
JWT_EXPIRE_MINUTES=10080


# ------------------------------------------------------------------------------
# 7. OAuth SSO (linux.do)
# ------------------------------------------------------------------------------
# Create an app in linux.do developer console to get credentials
# 在 linux.do 开发者控制台创建应用以获取凭据

# OAuth app credentials / OAuth 应用凭据
# LINUXDO_CLIENT_ID=your_client_id
# LINUXDO_CLIENT_SECRET=your_client_secret

# OAuth callback URL (must match console configuration)
# OAuth 回调 URL（必须与控制台配置一致）
# LINUXDO_REDIRECT_URI=https://your-domain.com/api/auth/callback/linuxdo

# OAuth endpoints (usually no need to change)
# OAuth 端点（通常无需修改）
# LINUXDO_AUTHORIZE_URL=https://connect.linux.do/oauth2/authorize
# LINUXDO_TOKEN_URL=https://connect.linux.do/oauth2/token
# LINUXDO_USERINFO_URL=https://connect.linux.do/api/user
# LINUXDO_SCOPES=user


# ------------------------------------------------------------------------------
# 8. AI Game Analysis Configuration / AI 游戏分析配置
# ------------------------------------------------------------------------------
# Separate from game AI, for post-game analysis
# 独立于游戏 AI，用于赛后分析

# Analysis-specific Provider [optional] / 分析专用服务商 [可选]
# Options / 可选值: openai, deepseek, anthropic, moonshot, qwen, glm, doubao, minimax
# If not set, uses default OpenAI configuration
# 如未设置，使用默认 OpenAI 配置
# ANALYSIS_PROVIDER=

# Analysis-specific model (recommend advanced models)
# 分析专用模型（推荐使用高级模型）
ANALYSIS_MODEL=gpt-4o

# Analysis mode / 分析模式
# comprehensive = detailed analysis / 详细分析
# quick = fast analysis / 快速分析
# custom = custom settings / 自定义设置
ANALYSIS_MODE=comprehensive

# Analysis language / 分析语言
# auto = auto-detect / 自动检测 | zh = Chinese / 中文 | en = English / 英文
ANALYSIS_LANGUAGE=auto

# Analysis result caching / 分析结果缓存
ANALYSIS_CACHE_ENABLED=true

# Analysis generation parameters / 分析生成参数
ANALYSIS_MAX_TOKENS=4000
ANALYSIS_TEMPERATURE=0.7


# ------------------------------------------------------------------------------
# 9. Multi-Provider Configuration / 多服务商配置
# ------------------------------------------------------------------------------
# Supported / 支持的服务商: OPENAI, ANTHROPIC, DEEPSEEK, MOONSHOT, QWEN, GLM, DOUBAO, MINIMAX
# Each supports / 每个支持: {PREFIX}_API_KEY, {PREFIX}_BASE_URL, {PREFIX}_MODEL,
#                          {PREFIX}_MAX_RETRIES, {PREFIX}_TEMPERATURE, {PREFIX}_MAX_TOKENS

# --- DeepSeek ---
# DEEPSEEK_API_KEY=
# DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
# DEEPSEEK_MODEL=deepseek-chat
# DEEPSEEK_MAX_RETRIES=2
# DEEPSEEK_TEMPERATURE=0.7
# DEEPSEEK_MAX_TOKENS=500

# --- Anthropic Claude ---
# ANTHROPIC_API_KEY=
# ANTHROPIC_BASE_URL=https://api.anthropic.com/v1
# ANTHROPIC_MODEL=claude-3-haiku-20240307
# ANTHROPIC_MAX_RETRIES=2
# ANTHROPIC_TEMPERATURE=0.7
# ANTHROPIC_MAX_TOKENS=500

# --- Moonshot (月之暗面) ---
# MOONSHOT_API_KEY=
# MOONSHOT_BASE_URL=https://api.moonshot.cn/v1
# MOONSHOT_MODEL=moonshot-v1-8k
# MOONSHOT_MAX_RETRIES=2
# MOONSHOT_TEMPERATURE=0.7
# MOONSHOT_MAX_TOKENS=500

# --- Qwen (通义千问) ---
# QWEN_API_KEY=
# QWEN_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
# QWEN_MODEL=qwen-turbo
# QWEN_MAX_RETRIES=2
# QWEN_TEMPERATURE=0.7
# QWEN_MAX_TOKENS=500

# --- GLM (智谱) ---
# GLM_API_KEY=
# GLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4
# GLM_MODEL=glm-4-flash
# GLM_MAX_RETRIES=2
# GLM_TEMPERATURE=0.7
# GLM_MAX_TOKENS=500

# --- Doubao (豆包) ---
# DOUBAO_API_KEY=
# DOUBAO_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
# DOUBAO_MODEL=doubao-pro-4k
# DOUBAO_MAX_RETRIES=2
# DOUBAO_TEMPERATURE=0.7
# DOUBAO_MAX_TOKENS=500

# --- MiniMax ---
# MINIMAX_API_KEY=
# MINIMAX_BASE_URL=https://api.minimax.chat/v1
# MINIMAX_MODEL=abab6.5s-chat
# MINIMAX_MAX_RETRIES=2
# MINIMAX_TEMPERATURE=0.7
# MINIMAX_MAX_TOKENS=500

# --- Custom Provider (1-9) / 自定义服务商 (1-9) ---
# AI_PROVIDER_1_NAME=custom
# AI_PROVIDER_1_API_KEY=
# AI_PROVIDER_1_BASE_URL=https://your-api.com/v1
# AI_PROVIDER_1_MODEL=your-model
# AI_PROVIDER_1_MAX_RETRIES=2
# AI_PROVIDER_1_TEMPERATURE=0.7
# AI_PROVIDER_1_MAX_TOKENS=500


# ------------------------------------------------------------------------------
# 10. Per-Player AI Configuration / 玩家专属 AI 配置
# ------------------------------------------------------------------------------
# Configure different AI for different seats (2-9) for diverse gameplay
# 为不同座位 (2-9) 配置不同 AI，实现多样化对局

# --- Method 1: Dedicated Configuration / 方法 1：独立配置 ---
# Configure independent LLM for specific seats (creates player_{seat_id} provider)
# 为特定座位配置独立 LLM（创建 player_{座位号} 服务商）
# AI_PLAYER_2_API_KEY=
# AI_PLAYER_2_BASE_URL=https://api.openai.com/v1
# AI_PLAYER_2_MODEL=gpt-4o-mini
# AI_PLAYER_2_TEMPERATURE=0.7
# AI_PLAYER_2_MAX_TOKENS=500
# AI_PLAYER_2_MAX_RETRIES=2

# --- Method 2: Map to Existing Provider / 方法 2：映射到现有服务商 ---
# Map seats to providers configured above (highest priority)
# 将座位映射到上面配置的服务商（最高优先级）
# AI_PLAYER_2_PROVIDER=deepseek
# AI_PLAYER_3_PROVIDER=anthropic
# AI_PLAYER_4_PROVIDER=openai

# --- Method 3: Batch JSON Mapping / 方法 3：批量 JSON 映射 ---
# Configure multiple seat-provider mappings at once
# 一次性配置多个座位-服务商映射
# AI_PLAYER_MAPPING={"2":"deepseek","3":"anthropic","4":"openai","5":"moonshot"}


# ------------------------------------------------------------------------------
# 11. Rate Limiting Configuration / 速率限制配置
# ------------------------------------------------------------------------------
# Control AI request rate and concurrency
# 控制 AI 请求速率和并发数

# Default provider rate limits / 默认服务商速率限制
DEFAULT_REQUESTS_PER_MINUTE=60
DEFAULT_MAX_CONCURRENCY=5
DEFAULT_BURST=3

# Per-game LLM request control / 单局游戏 LLM 请求控制
LLM_MAX_WAIT_SECONDS=8
LLM_PER_GAME_MIN_INTERVAL=0.5
LLM_PER_GAME_MAX_CONCURRENCY=2


# ------------------------------------------------------------------------------
# 12. Redis Configuration (Notification System)
# Redis 配置（通知系统）
# ------------------------------------------------------------------------------
# For cross-instance message broadcasting
# 用于跨实例消息广播

# Redis connection URL [optional] / Redis 连接 URL [可选]
# Format / 格式: redis://[:password]@host:port/db
# Example / 示例: redis://localhost:6379/0
#
# Development: System falls back to single-instance mode without Redis
# 开发环境：无 Redis 时系统回退到单实例模式
# Production: Recommended for multi-instance deployment
# 生产环境：推荐用于多实例部署
# REDIS_URL=


# ------------------------------------------------------------------------------
# 13. Frontend Configuration (Vite) / 前端配置 (Vite)
# ------------------------------------------------------------------------------
# For Docker deployment, frontend uses nginx reverse proxy, usually no config needed
# Docker 部署时，前端使用 nginx 反向代理，通常无需配置
# For local development direct backend connection
# 本地开发时直连后端

# Backend API URL / 后端 API 地址
# VITE_API_URL=http://localhost:8082
# VITE_API_BASE_URL=http://localhost:8082

# --- Sentry Error Monitoring / Sentry 错误监控 ---
# VITE_SENTRY_DSN=https://xxx@sentry.io/xxx
# VITE_SENTRY_ENV=production

# Performance monitoring sample rate (0.0 - 1.0)
# 性能监控采样率 (0.0 - 1.0)
# VITE_SENTRY_TRACES_SAMPLE_RATE=0.1

# Session Replay configuration / 会话回放配置
# VITE_SENTRY_ENABLE_REPLAY=false
# VITE_SENTRY_REPLAYS_SESSION_SAMPLE_RATE=0.1
# VITE_SENTRY_REPLAYS_ON_ERROR_SAMPLE_RATE=1.0


# ------------------------------------------------------------------------------
# 14. Database Configuration / 数据库配置
# ------------------------------------------------------------------------------

# Database URL [optional] / 数据库连接 URL [可选]
# Default: SQLite in DATA_DIR
# 默认：DATA_DIR 目录下的 SQLite
# Examples / 示例:
#   SQLite:     sqlite:///data/werewolf.db (default)
#   PostgreSQL: postgresql://user:password@localhost:5432/werewolf
# DATABASE_URL=

# Run database migrations on startup / 启动时运行数据库迁移
# Set to false to skip auto-migration (for manual runs)
# 设为 false 跳过自动迁移（手动执行时）
RUN_DB_MIGRATIONS=true


# ==============================================================================
# Configuration Examples / 配置示例
# ==============================================================================
#
# --- Minimal Configuration (OpenAI only) / 最小配置（仅 OpenAI）---
# JWT_SECRET_KEY=your-random-secret-key-at-least-32-characters
# OPENAI_API_KEY=sk-your-key-here
#
# --- Mock Mode (no API key needed) / 模拟模式（无需 API 密钥）---
# JWT_SECRET_KEY=your-random-secret-key-at-least-32-characters
# LLM_USE_MOCK=true
#
# --- Multi-Provider Battle / 多服务商对战 ---
# JWT_SECRET_KEY=xxx
# OPENAI_API_KEY=sk-xxx
# DEEPSEEK_API_KEY=sk-xxx
# ANTHROPIC_API_KEY=sk-ant-xxx
# AI_PLAYER_MAPPING={"2":"openai","3":"deepseek","4":"anthropic"}
#
# ==============================================================================
